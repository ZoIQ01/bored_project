{% extends "activities/base.html" %}
{% load static %}

{% block title %}Activities{% endblock %}

{% block extra_head %}
  <script defer src="{% static 'activities/mark_done.js' %}"></script>
{% endblock %}

{% block content %}
{% include 'activities/filter.html' %}
{% include 'activities/sort_by.html' %}

<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <h1 class="h3 mb-0">Activities</h1>
  <div class="d-flex align-items-center gap-2">
    <span id="done-count" class="badge text-bg-light border">Done: 0</span>
    <span class="badge text-bg-light border">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    <button id="done-clear" type="button" class="btn btn-outline-secondary btn-sm">Clear Done</button>
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'activities_list' %}">Reset All</a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>done</th>
          <th>id</th>
          <th>type</th>
          <th>participants</th>
          <th>price</th>
          <th>accessibility</th>
          <th>activity</th>
          <th>link</th>
        </tr>
      </thead>

      <tbody>
        {% for a in page_obj %}
        <tr>
          <td>
            <input
              class="form-check-input"
              type="checkbox"
              aria-label="Mark activity {{ a.id }} as done"
              data-activity-done-toggle
              data-activity-id="{{ a.id }}"
            >
            <span class="badge text-bg-success d-none" data-activity-done-badge>Done</span>
          </td>
          <td>{{ a.id }}</td>
          <td><span class="badge text-bg-secondary">{{ a.type }}</span></td>
          <td>{{ a.participants }}</td>
          <td>{{ a.price }}</td>
          <td>{{ a.accessibility }}</td>
          <td><a class="link-primary" href="{% url 'activity_detail' a.id %}">{{ a.activity }}</a></td>
          <td>
            {% if a.link %}
              <a class="link-secondary" href="{{ a.link }}" target="_blank" rel="noopener noreferrer">Open</a>
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-4 text-muted">Nothing found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mt-3">
  <div>
    {% if page_obj.has_previous %}
      {% if request.GET.urlencode %}
        <a class="btn btn-outline-primary btn-sm" href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}">← Prev</a>
      {% else %}
        <a class="btn btn-outline-primary btn-sm" href="?page={{ page_obj.previous_page_number }}">← Prev</a>
      {% endif %}
    {% endif %}
  </div>

  <div>
    {% if page_obj.has_next %}
      {% if request.GET.urlencode %}
        <a class="btn btn-outline-primary btn-sm" href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}">Next →</a>
      {% else %}
        <a class="btn btn-outline-primary btn-sm" href="?page={{ page_obj.next_page_number }}">Next →</a>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
